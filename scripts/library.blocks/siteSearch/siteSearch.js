import{defaults}from"./defaults.js";import{extendParams,hasProperty,normalizeActionName,normalizeModuleName}from"../commonFunctions/index.js";import{Form}from"../form/index.js";const modulesToBeInstalled={};class SiteSearch{constructor(e=".site-search",t={}){var o=this;o.extendedParams=extendParams(defaults,t),o.parentElement="object"==typeof e?e:document.querySelector(e),o.modules={},o.actions={},o.onActionCallbacks={},o.setSearchForm(),o.setControlButtons(),o.instalAllModules(),o.setDelegation(),document.addEventListener("click",o.documentHandler.bind(o)),o.attachAction({delegationId:"siteSearchToggleButton",eventType:"click",actionName:"toggleSearchForm",func:o.toggleSearchForm.bind(o)}).attachAction({delegationId:"siteSearchCloseButton",eventType:"click",actionName:"toggleSearchForm",func:o.toggleSearchForm.bind(o)})}setElement(e,t){var o=this;o[e]=t?o.parentElement.querySelector(t):null}setSearchForm(){var e=this;e.searchForm=new Form(e.extendedParams.searchForm.selectors),e.searchForm.form.addEventListener("submit",e=>e.preventDefault())}setControlButtons(){var e=this,t=e["extendedParams"];e.setElement("toggleButton",t.toggleButton.selectors),e.setElement("searchButton",t.searchButton.selectors),e.setElement("closeButton",t.closeButton.selectors),e.toggleButton.setAttribute("data-delegation-id","siteSearchToggleButton"),e.closeButton&&e.closeButton.setAttribute("data-delegation-id","siteSearchCloseButton")}setDelegation(){var e=this;e.parentElement.addEventListener("click",e.onClick.bind(e))}onClick(e){var t=this,o=e.target.dataset["delegationId"];if(hasProperty(t.actions,o)&&hasProperty(t.actions[o],"click"))for(const a of Object.values(t.actions[o].click))a(e)}attachAction({delegationId:e,eventType:t,actionName:o,func:a}){var s=this;return hasProperty(s,"actions")||(s.actions={}),hasProperty(s.actions,e)||(s.actions[e]={}),hasProperty(s.actions[e],t)||(s.actions[e][t]={}),s.actions[e][t][o]=a,s}onAction(e,t){e=normalizeActionName(e);return this.onActionCallbacks["on"+e]=t,this}instalAllModules(){let e={};for(const t of Object.values(modulesToBeInstalled))e={...e,...t};this.use(e)}use(e){var t=this,o=Object.keys(e);if(0!==o.length){t.modules={...t.modules,...e};for(const s of o){var a=normalizeModuleName(s);hasProperty(t.extendedParams,a)?t[a]=new e[s](t,t.extendedParams[a]):t[a]=new e[s](t)}return t}}toggleSearchForm(){var e=this,t=e["extendedParams"];e.searchForm.form.classList.toggle(t.searchForm.hiddenClass),t.toggleButton.addActiveClass&&e.toggleButton.classList.toggle(t.toggleButton.activeClass)}documentHandler(e){var t=this,e=e["target"];t.parentElement.contains(e)||t.searchForm.form.classList.contains(t.extendedParams.searchForm.hiddenClass)||t.toggleSearchForm()}}export{SiteSearch};