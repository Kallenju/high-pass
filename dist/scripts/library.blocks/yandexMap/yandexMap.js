import{defaults}from"./defaults.js";import{extendParams}from"../commonFunctions/index.js";class YandexMap{constructor(e=".yandex-map",a={}){var r=this;r.extendedParams=extendParams(defaults,a),r.parentElement="object"==typeof e?e:document.querySelector(e),r.myMap=null,r.mapLoaded=!1,r.extendedParams.lazyLoad.on?r.lazyLoad():r.createMap()}createMap(){const e=this,a=e["extendedParams"];window.ymaps.ready(()=>{e.myMap=new window.ymaps.Map(e.parentElement,{center:a.center,zoom:a.zoom}),e.deleteControls(),e.addMyPlacemarks(e.createPlacemarksArr(a.placemarks)),e.mapLoaded=!0})}deleteControls(){for(const e of this.extendedParams.controlsToBeDeleted)this.myMap.controls.remove(e)}createMyPlacemark({coordinates:e,properties:a,options:r,onClick:t=null}){const o=new window.ymaps.Placemark(e,a,r);return t&&o.events.add("click",t),o}createPlacemarksArr(e){var a=this;a.placemarksArr=[];for(const r of e)a.placemarksArr.push(a.createMyPlacemark(r));return a.placemarksArr}addMyPlacemarks(e){for(const a of e)this.myMap.geoObjects.add(a)}lazyLoad(){const e=this;e.extendedParams.lazyLoad.loadingUsingIntersectionObserver.on&&e.loadingUsingIntersectionObserver(function(){e.loadScript().then(()=>{e.deleteStaticMap(),e.createMap()})})}loadScript(){const t=this.extendedParams.lazyLoad;return new Promise((e,a)=>{const r=document.createElement("script");r.src=t.scriptSrc,document.head.append(r),r.onload=()=>e(r),r.onerror=()=>a(new Error("Ошибка загрузки скрипта "+t.scriptSrc))})}deleteStaticMap(){var e=this.extendedParams.lazyLoad.staticMap;if(e.selectors){const a=document.querySelector(e.selectors);a&&a.remove()}}loadingUsingIntersectionObserver(a){const r=this;var e=r.extendedParams.lazyLoad.loadingUsingIntersectionObserver,t=document.querySelector(e.target);const o=new IntersectionObserver(e=>{r.mapLoaded||0<e[0].intersectionRatio&&(a(),o.disconnect())},e.options);o.observe(t)}}export{YandexMap};